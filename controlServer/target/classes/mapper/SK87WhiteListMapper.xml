<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tenger.control.sk87.dao.SK87WhiteListMapper">
  <resultMap id="BaseResultMap" type="com.tenger.control.sk87.entity.SK87WhiteList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="value" jdbcType="VARCHAR" property="value" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="device_sn" jdbcType="VARCHAR" property="deviceSn" />
    <result column="start" jdbcType="TIMESTAMP" property="start" />
    <result column="end" jdbcType="TIMESTAMP" property="end" />
    <result column="action_id" jdbcType="INTEGER" property="actionId" />
    <result column="start_time" jdbcType="VARCHAR" property="startTime" />
    <result column="end_time" jdbcType="VARCHAR" property="endTime" />
    <result column="repeat_type" jdbcType="TINYINT" property="repeatType" />
    <result column="repeat" jdbcType="VARCHAR" property="repeat" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="tenant_id" jdbcType="VARCHAR" property="tenantId" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from tb_sk87_white_list
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.tenger.control.sk87.entity.SK87WhiteList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into tb_sk87_white_list (`value`, `type`, `status`, 
      device_sn, `start`, `end`, 
      action_id, start_time, end_time, 
      repeat_type, `repeat`)
    values (#{value,jdbcType=VARCHAR}, #{type,jdbcType=INTEGER}, #{status,jdbcType=TINYINT}, 
      #{deviceSn,jdbcType=VARCHAR}, #{start,jdbcType=TIMESTAMP}, #{end,jdbcType=TIMESTAMP}, 
      #{actionId,jdbcType=INTEGER}, #{startTime,jdbcType=VARCHAR}, #{endTime,jdbcType=VARCHAR}, 
      #{repeatType,jdbcType=TINYINT}, #{repeat,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.tenger.control.sk87.entity.SK87WhiteList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_sk87_white_list
    set `value` = #{value,jdbcType=VARCHAR},
      `type` = #{type,jdbcType=INTEGER},
      `status` = #{status,jdbcType=TINYINT},
      device_sn = #{deviceSn,jdbcType=VARCHAR},
      `start` = #{start,jdbcType=TIMESTAMP},
      `end` = #{end,jdbcType=TIMESTAMP},
      action_id = #{actionId,jdbcType=INTEGER},
      start_time = #{startTime,jdbcType=VARCHAR},
      end_time = #{endTime,jdbcType=VARCHAR},
      repeat_type = #{repeatType,jdbcType=TINYINT},
      `repeat` = #{repeat,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, `value`, `type`, `status`, device_sn, `start`, `end`, action_id, start_time, 
    end_time, repeat_type, `repeat`, create_time, update_time, tenant_id
    from tb_sk87_white_list
    where id = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, `value`, `type`, `status`, device_sn, `start`, `end`, action_id, start_time, 
    end_time, repeat_type, `repeat`, create_time, update_time, tenant_id
    from tb_sk87_white_list
  </select>

  <select id="selectByDto" resultMap="BaseResultMap">
    SELECT * FROM tb_sk87_white_list
    WHERE 1
    <if test="search!=null and search!=''">
      AND CONCAT_WS(',',value) LIKE #{search}
    </if>
    <if test="deviceSn!=null and deviceSn!=''">
      AND device_sn=#{deviceSn}
    </if>
    <if test="userId!=null and userId!=''">
      AND value=#{userId}
    </if>
  </select>

  <select id="countByValueAndTypeAndSn" resultType="java.lang.Integer">
    SELECT COUNT(1) FROM tb_sk87_white_list
    WHERE value=#{value} AND type=#{type} AND device_sn=#{deviceSn}
    FOR UPDATE
  </select>

  <select id="selectByActionId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    SELECT * FROM tb_sk87_white_list
    WHERE action_id=#{actionId}
    LIMIT 1
  </select>

  <update id="updateStatusById">
    UPDATE tb_sk87_white_list
    SET status=#{status}
    WHERE id=#{id}
  </update>

  <select id="selectByTypeInValueInDeviceSn" resultMap="BaseResultMap">
    SELECT * FROM tb_sk87_white_list
    WHERE type=#{type}
    AND FIND_IN_SET(value, #{values})
    AND FIND_IN_SET(device_sn, #{deviceSNs})
  </select>


  <insert id="insertList" keyColumn="id" keyProperty="id" useGeneratedKeys="true">
    INSERT into tb_sk87_white_list (`value`, `type`, `status`, device_sn, `start`, `end`, action_id,
                                    start_time, end_time, repeat_type, `repeat`) VALUES
    <foreach collection="list" index="index" item="item" separator=",">
      (#{item.value}, #{item.type}, #{item.status}, #{item.deviceSn}, #{item.start}, #{item.end}, #{item.actionId},
       #{item.startTime}, #{item.endTime}, #{item.repeatType}, #{item.repeat})
    </foreach>
    ON DUPLICATE KEY UPDATE
      `start`=VALUES(start),
      `end`=VALUES(end),
      start_time=VALUES(start_time),
      end_time=VALUES(end_time),
      repeat_type=VALUES(repeat_type),
      `repeat`=VALUES(`repeat`)
  </insert>

  <delete id="deleteByIds" parameterType="java.lang.String">
    DELETE FROM tb_sk87_white_list
    WHERE FIND_IN_SET(id, #{ids})
  </delete>

  <select id="selectByValueAndDeviceSn" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT * FROM tb_sk87_white_list
    WHERE value=#{value}
      AND device_sn=#{deviceSn}
    LIMIT 1
  </select>

  <select id="selectUserIdsByDeviceSn" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT GROUP_CONCAT(value) FROM tb_sk87_white_list
    WHERE device_sn=#{deviceSn}
    GROUP BY device_sn
  </select>
</mapper>